# 메모리 계층

- 레지스터, 캐시, 메모리, 저장장치
- 속도는 레지스터가 가장 빠르며, 용량은 저장장치가 가장 크다
  - 레지스터: CPU 안에 있는 작은 메모리. 휘발성. 속도 가장 빠름. 기억 용량이 가장 작음
  - 캐시: L1, L2 캐시를 지칭. 휘발성, 속도 빠름, 기억 용량 작음
  - 주기억장치: RAM. 휘발성, 속도 보통, 기억 용량 보통
  - 보조기억장치: HDD, SDD를 일컬으며, 휘발성, 속도 낮음, 기억 용량이 많음
- 계층 위로 올라갈수록(레지스터) 비싸진다. 경제성과 캐시 때문.
- 로딩 중... 은 데이터를 RAM으로 전송하는 과정이 아직 끝나지 않았음을 의미
- 램은 하드디스크로부터 일정량의 데이터를 복사해서 임시 저장하고 필요 시마다 CPU에 전달한다.

## 1. 캐시

- 데이터를 미리 복사해놓은 임시 저장소
- 빠른 장치와 느린 장치에서 속도 차이에 따른 병목 현상을 줄이기 위한 메모리
- 데이터를 접근하는 시간이 오래 걸리는 경우를 해결하고, 무언가 다시 계산하는 시간을 절약할 수 있다.

### 1. 지역성의 원리

- 캐시를 직접 설정할 때, 자주 사용하는 데이터를 기반으로 설정한다.
- 그 근거는 지역성에 있다.

#### 1. 시간 지역성

- 최근 사용한 데이터에 다시 접근하려는 특성
- ex) for반복문으로 이루어진 코드 안의 변수 i에 계속해서 접근이 이루어진다.

```js
let arr = Array.from({ length: 10 }, () => 0);
console.log(arr);
for (let i = 0; i < 10; i += 1) {
  arr[i] = i;
}
console.log(arr);
/*
[
    0, 0, 0, 0, 0,
    0, 0, 0, 0, 0
]
[
    0, 1, 2, 3, 4,
    5, 6, 7, 8, 9
]
*/
```

#### 2. 공간 지역성

- 최근 접근한 데이터를 이루고 있는 공간이나 그 가까운 공간에 접근하는 특성
- 공간을 나타내는 arr의 각 요소들에 i가 할당되며 해당 배열에 연속적으로 접근함

## 2. 캐시히트와 캐시미스

- 캐시히트: 캐시에서 원하는 데이터를 찾았음. 해당 데이터를 제어장치를 거쳐 가져오게 됨. 위치도 가깝고, CPU 내부 버스를 기반으로 작동하므로 빠르다.
- 캐시미스: 캐시가 없으면 주메모리로 가서 데이터를 찾아오는 것. 메모리에서 가져옴. 시스템 버스를 기반으로 작동하므로 느리다.

### 1. 캐시매핑

- 캐시가 히트되기 위해 매핑하는 방법
- CPU의 레지스터와 주메모리(RAM) 간 데이터를 주고받을 때를 기반
  - 직접 매핑: 처리가 빠르지만 충돌 발생이 잦음
  - 연관 매핑: 순서를 일치시키지 않고 관련 있는 캐시와 메모리를 매핑. 충돌이 적으나, 속도가 느림
  - 집합 연관 매핑: 순서는 일치시키지만 집합을 둬서 저장하며 블록화되어 있기 때문에 검색은 효율적

#### 1. 웹 브러우저의 캐시

- 소프트웨어적인 캐시로는 웹 브라우저의 작은 저장소 쿠키, 로컬 스토리지, 세션 스토리지가 있음
- 사용자의 커스텀 정보, 인증 모듈 관련 사항을 브라우저에 저장해서 추후 서버에 요청할 때 인가, 중복 요청 방지를 위해 쓰임

1. 쿠키

   - 만료기한이 있는 키-값 저장소
   - 4KB까지 데이터를 저장할 수 있고 만료기한을 정할 수 있음. 보통 서버에서 만료기한을 정함.
   - 쿠키 설정 시, `documnet.cookie`로 쿠키를 볼 수 없게 httponly 옵션을 건다.

2. 로컬 스토리지

   - 만료기한이 없는 키-값 저장소
   - 10MB까지 저장할 수 있고 웹 브라우저를 닫아도 유지됨
   - 도메인 단위로 저장, 생성됨
   - HTML5를 지원하지 않는 웹 브라우저에서는 사용할 수 없음
   - 클라이언트에서만 수정 가능

3. 세션 스토리지
   - 만료기한이 없는 키-값 저장소
   - 탭 단위로 세션 스토리지를 생성
   - 탭을 닫을 때 데이터 삭제
   - 5MB까지 저장 가능
   - HTML5를 지원하지 않는 웹 브라우저에서는 사용할 수 없음
   - 클라이언트에서만 수정 가능

#### 2. 데이터베이스의 캐싱 계층

- 데이터베이스 시스템을 구축할 때도 메인 데이터베이스 위에 레디스 데이터 베이스 계층을 '캐싱 계층'으로 둬서 성능을 향상시키기도 함
- 캐시히트: 레디스로부터 데이터를 읽어온다.
- 데이터를 레디스에 쓴다.
- 캐시미스: 메인 DB로부터 데이터를 가져온다.
